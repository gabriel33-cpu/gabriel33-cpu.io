<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>RPP Agency - Pago del Servicio</title>
<link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600;700&display=swap" rel="stylesheet" />
<style>
  body { font-family: 'Montserrat', sans-serif; background: #faf9f7; text-align: center; padding: 3rem; }
  h1 { color: #1a1a1a; font-size:2.5rem; margin-bottom:0.5rem; }
  #servicio-nombre { font-weight: 600; margin-top: 1rem; font-size:1.2rem; color:#1a1a1a; }
  .pay-buttons { display: flex; gap: 1rem; justify-content: center; margin-top: 2rem; flex-wrap: wrap; }
  .pay-buttons form button, .pay-buttons button { background-color: #1a1a1a; color: #fff; border: none; border-radius: 10px; padding: 1rem 2rem; font-weight: 600; cursor: pointer; transition: 0.4s; font-size:1rem; }
  .pay-buttons form button:hover, .pay-buttons button:hover { background-color: #b8860b; }
  p.info { margin-top:1rem; color:#555; font-size:0.95rem; }
</style>
</head>
<body>

<h1>Selecciona tu método de pago</h1>
<p id="servicio-nombre"></p>

<div class="pay-buttons">
  <!-- PayPal -->
  <form id="paypal-form" action="https://www.paypal.com/cgi-bin/webscr" method="post" target="_blank">
    <input type="hidden" name="cmd" value="_xclick">
    <input type="hidden" name="business" value="rppagencyy@gmail.com">
    <input type="hidden" name="item_name" value="">
    <input type="hidden" name="amount" value="">
    <input type="hidden" name="currency_code" value="EUR">
    <button type="submit">Pagar con PayPal</button>
  </form>

  <!-- Stripe -->
  <button id="stripe-btn">Pagar con Tarjeta</button>
</div>

<p class="info">Serás redirigido a una pasarela segura para completar tu pago.</p>

<script src="https://js.stripe.com/v3/"></script>
<script>
  // Datos del servicio desde la URL
  const params = new URLSearchParams(window.location.search);
  const nombre = params.get('nombre');
  const precio = params.get('precio');

  if(nombre && precio){
    document.getElementById('servicio-nombre').textContent = `${nombre} - ${precio} €`;
    document.querySelector('#paypal-form input[name="item_name"]').value = nombre;
    document.querySelector('#paypal-form input[name="amount"]').value = precio;
  }

  // Stripe Checkout
  const stripe = Stripe('pk_test_51SBLtI0gX3Yktc5tvvSwyIq3TfHynuTPTeQsnQ1fI4TvQaCD3YSD1ZTeTOouS8KfO9PIfqsHAyszVbGmDuyMDJoA00fA7sEof8');

  document.getElementById('stripe-btn').addEventListener('click', async () => {
    if(!nombre || !precio) return alert('Error: datos del servicio no encontrados.');

    try {
      const response = await fetch('https://TU-BACKEND-PUBLICO.up.railway.app/create-checkout-session', { 
        method: 'POST',
        headers: {'Content-Type':'application/json'},
        body: JSON.stringify({ nombre, precio })
      });

      const session = await response.json();
      if(session.url){
        window.location.href = session.url; // redirige al checkout
      } else {
        alert('Error al crear la sesión de pago.');
      }
    } catch (err) {
      console.error(err);
      alert('Error al conectar con el servidor de pagos.');
    }
  });
</script>

</body>
</html>

